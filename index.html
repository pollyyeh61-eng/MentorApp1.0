<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å°å¸«å°ˆå±¬å¹³å°</title>
    <style>
        :root {
            --gold-light: #FFD700; --gold-main: #D4AF37; --gold-dark: #B8860B;
            --bg-gradient: radial-gradient(circle at top, #2C2C2C 0%, #0A0A0A 100%);
        }
        body {
            background: var(--bg-gradient); color: #E0E0E0;
            font-family: "PingFang TC", sans-serif; display: flex; flex-direction: column;
            align-items: center; min-height: 100vh; margin: 0; padding: 40px 20px; box-sizing: border-box;
        }
        h1 { background: linear-gradient(135deg, var(--gold-light), var(--gold-dark)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; letter-spacing: 4px; }
        
        .card {
            width: 100%; max-width: 380px; background: rgba(255,255,255,0.05);
            padding: 25px; border-radius: 24px; border: 1px solid rgba(212, 175, 55, 0.2);
            text-align: center; display: none; box-shadow: 0 20px 40px rgba(0,0,0,0.4);
        }

        .input-group { margin-bottom: 15px; text-align: left; }
        label { display: block; font-size: 0.75rem; color: var(--gold-main); margin-bottom: 5px; }
        input {
            width: 100%; padding: 12px; background: rgba(255,255,255,0.08);
            border: 1px solid rgba(212, 175, 55, 0.3); border-radius: 10px; color: white; box-sizing: border-box;
        }

        .action-btn {
            width: 100%; padding: 14px; margin-top: 10px;
            background: linear-gradient(135deg, var(--gold-light), var(--gold-dark));
            border: none; border-radius: 12px; color: #000; font-weight: 800; cursor: pointer;
        }
        .action-btn:disabled { background: #333; color: #777; }
        .secondary-btn { background: none; border: 1px solid var(--gold-main); color: var(--gold-main); margin-top: 10px; }
        .danger-btn { background: #600; color: white; border: none; margin-top: 20px; font-size: 0.8rem; }

        .terms-container { margin: 15px 0; padding: 10px; height: 80px; overflow-y: scroll; background: rgba(0,0,0,0.4); font-size: 0.7rem; text-align: left; }
        .toggle-link { margin-top: 15px; font-size: 0.8rem; color: var(--gold-main); cursor: pointer; text-decoration: underline; }

        /* é¸å–®ç¶²æ ¼ */
        .menu-grid { width: 100%; max-width: 400px; display: none; flex-direction: column; gap: 12px; }
        .btn {
            background: #1a1a1a; border: 1px solid rgba(212, 175, 55, 0.3);
            border-radius: 15px; padding: 15px; text-decoration: none; color: white; display: flex; align-items: center;
        }
        .icon-box { width: 40px; height: 40px; margin-right: 15px; display: flex; align-items: center; justify-content: center; background: #000; border-radius: 10px; border: 1px solid var(--gold-main); }
    </style>
</head>
<body>

    <h1 id="mainTitle">å°å¸«å°ˆå±¬å¹³å°</h1>

    <div id="authBox" class="card">
        <h2 id="authTitle" style="color:var(--gold-light);">æˆå“¡é€²å…¥</h2>
        <div class="input-group">
            <label>æˆå“¡éƒµç®± (å·²æ›è¼‰å³æ™‚æš«å­˜)</label>
            <input type="email" id="email" placeholder="è¼¸å…¥ Email" oninput="saveToLocal()">
        </div>
        <div class="input-group">
            <label>é€šè¡Œå¯†ç¢¼</label>
            <input type="password" id="password" placeholder="è¼¸å…¥å¯†ç¢¼" oninput="saveToLocal()">
        </div>

        <div id="regExtra" style="display: none;">
            <div class="terms-container">åŒæ„æ¢æ¬¾ï¼šæœ¬è¾¦å…¬å®¤è³‡æºåƒ…ä¾›æˆå“¡å­¸ç¿’ä½¿ç”¨ï¼Œç¦æ­¢éæ³•å‚³éã€‚</div>
            <div style="font-size:0.8rem; margin-bottom:10px;">
                <input type="checkbox" id="agreeCheck" onchange="updateBtnState()"> æˆ‘å·²é–±è®€ä¸¦åŒæ„æ¢æ¬¾
            </div>
        </div>

        <button class="action-btn" id="submitBtn">ç«‹å³é€²å…¥</button>
        <div id="forgotPwd" class="toggle-link" style="margin-top:10px; color:#888;">å¿˜è¨˜å¯†ç¢¼ï¼Ÿ</div>
        <div id="toggleMode" class="toggle-link">ç”³è«‹å…¥é§è¾¦å…¬å®¤</div>
    </div>

    <div id="mainMenu" class="menu-grid">
        <a href="http://www.webcoursestest.hairweb.net" class="btn"><div class="icon-box">ğŸ—ºï¸</div><div><b>ç¶“ç‡Ÿåœ°åœ–</b></div></a>
        <a href="https://www.client.hairweb.net" class="btn"><div class="icon-box">ğŸ‘¥</div><div><b>å®¢æˆ¶ç®¡ç†</b></div></a>
        <div class="btn" style="cursor:pointer;" id="memberInfoBtn"><div class="icon-box">ğŸ‘¤</div><div><b>æˆå“¡è³‡è¨Š</b><br><small>ä¿®æ­£èˆ‡ç®¡ç†å¸³è™Ÿ</small></div></div>
        <button id="logoutBtn" style="background:none; border:none; color:#555; text-decoration:underline; cursor:pointer; margin-top:20px;">é›¢é–‹è¾¦å…¬å®¤</button>
    </div>

    <div id="infoBox" class="card">
        <h2 style="color:var(--gold-light);">æˆå“¡å¸³è™Ÿè³‡è¨Š</h2>
        <div class="input-group">
            <label>é¡¯ç¤ºåç¨± (Display Name)</label>
            <input type="text" id="displayName" placeholder="å°šæœªè¨­å®šåç¨±">
        </div>
        <p id="infoEmail" style="font-size:0.8rem; color:#888;"></p>
        <button class="action-btn" id="updateInfoBtn">ä¿®æ­£ä¸¦å„²å­˜é›²ç«¯</button>
        <button class="action-btn secondary-btn" id="backBtn">è¿”å›é¸å–®</button>
        <hr style="margin-top:30px; border:0.5px solid #333;">
        <button class="action-btn danger-btn" id="deleteAccBtn">âš ï¸ åˆªé™¤å¸³è™Ÿä¸¦æ°¸ä¹…é›¢é–‹</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut, sendEmailVerification, sendPasswordResetEmail, updateProfile, deleteUser } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAM4d9GqtSjNOlfguew8BktZ8ptrnBzvpc",
            authDomain: "mentor-app-b76e3.firebaseapp.com",
            projectId: "mentor-app-b76e3",
            storageBucket: "mentor-app-b76e3.firebasestorage.app",
            messagingSenderId: "757249551762",
            appId: "1:757249551762:web:1c5bfff8b1ee222047654b"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // --- A. å³æ™‚æš«å­˜åŠŸèƒ½ (Local Save) ---
        window.saveToLocal = () => {
            localStorage.setItem('temp_email', document.getElementById('email').value);
            localStorage.setItem('temp_pwd', document.getElementById('password').value);
        };
        // è¼‰å…¥æ™‚è‡ªå‹•å¡«å…¥æš«å­˜
        document.getElementById('email').value = localStorage.getItem('temp_email') || '';
        document.getElementById('password').value = localStorage.getItem('temp_pwd') || '';

        // --- B. æ¨¡å¼åˆ‡æ›é‚è¼¯ ---
        let isLoginMode = true;
        const toggleBtn = document.getElementById('toggleMode');
        const submitBtn = document.getElementById('submitBtn');

        toggleBtn.onclick = () => {
            isLoginMode = !isLoginMode;
            document.getElementById('authTitle').innerText = isLoginMode ? "æˆå“¡é€²å…¥" : "æˆå“¡è¨»å†Š";
            submitBtn.innerText = isLoginMode ? "ç«‹å³é€²å…¥" : "å®Œæˆè¨»å†Š";
            document.getElementById('regExtra').style.display = isLoginMode ? 'none' : 'block';
            document.getElementById('forgotPwd').style.display = isLoginMode ? 'block' : 'none';
            updateBtnState();
        };

        window.updateBtnState = () => {
            submitBtn.disabled = !isLoginMode && !document.getElementById('agreeCheck').checked;
        };

        // --- C. å¿˜è¨˜å¯†ç¢¼ ---
        document.getElementById('forgotPwd').onclick = async () => {
            const email = document.getElementById('email').value;
            if(!email) return alert("è«‹å…ˆåœ¨æ¬„ä½ä¸­è¼¸å…¥æ‚¨çš„ Email");
            try {
                await sendPasswordResetEmail(auth, email);
                alert("é‡è¨­éƒµä»¶å·²å¯„å‡ºï¼Œè«‹æª¢æŸ¥ä¿¡ç®±ã€‚");
            } catch (e) { alert("éŒ¯èª¤ï¼š" + e.message); }
        };

        // --- D. ç™»å…¥/è¨»å†Šæ ¸å¿ƒ ---
        submitBtn.onclick = async () => {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            try {
                if (isLoginMode) {
                    await signInWithEmailAndPassword(auth, email, password);
                    localStorage.removeItem('temp_pwd'); // ç™»å…¥æˆåŠŸæ¸…é™¤æš«å­˜å¯†ç¢¼
                } else {
                    const res = await createUserWithEmailAndPassword(auth, email, password);
                    await sendEmailVerification(res.user);
                    alert("è¨»å†ŠæˆåŠŸï¼Œè«‹è‡³ä¿¡ç®±å®Œæˆé©—è­‰ã€‚");
                }
            } catch (e) { alert("æç¤ºï¼š" + e.message); }
        };

        // --- E. æˆå“¡è³‡è¨Šç®¡ç† ---
        document.getElementById('memberInfoBtn').onclick = () => {
            document.getElementById('mainMenu').style.display = 'none';
            document.getElementById('infoBox').style.display = 'block';
            document.getElementById('infoEmail').innerText = "ç™»å…¥ä¿¡ç®±ï¼š" + auth.currentUser.email;
            document.getElementById('displayName').value = auth.currentUser.displayName || "";
        };

        document.getElementById('backBtn').onclick = () => {
            document.getElementById('infoBox').style.display = 'none';
            document.getElementById('mainMenu').style.display = 'flex';
        };

        // ä¿®æ­£ä¸¦å„²å­˜è‡³é›²ç«¯
        document.getElementById('updateInfoBtn').onclick = async () => {
            const newName = document.getElementById('displayName').value;
            try {
                await updateProfile(auth.currentUser, { displayName: newName });
                alert("é›²ç«¯è³‡æ–™å·²æˆåŠŸæ›´æ–°ï¼");
            } catch (e) { alert("æ›´æ–°å¤±æ•—ï¼š" + e.message); }
        };

        // åˆªé™¤å¸³è™Ÿ
        document.getElementById('deleteAccBtn').onclick = async () => {
            if(confirm("ç¢ºå®šè¦åˆªé™¤å¸³è™Ÿå—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼Œæ‚¨å°‡å¤±å»æ‰€æœ‰è¨ªå•æ¬Šé™ã€‚")) {
                try {
                    await deleteUser(auth.currentUser);
                    alert("å¸³è™Ÿå·²åˆªé™¤ã€‚");
                } catch (e) { alert("å®‰å…¨å› ç´ ï¼Œè«‹é‡æ–°ç™»å…¥å¾Œå†åŸ·è¡Œåˆªé™¤ã€‚"); }
            }
        };

        // --- F. ç‹€æ…‹ç›£æ§ ---
        onAuthStateChanged(auth, (user) => {
            document.getElementById('authBox').style.display = user ? 'none' : 'block';
            document.getElementById('mainMenu').style.display = user ? 'flex' : 'none';
            document.getElementById('infoBox').style.display = 'none';
            if(!user) document.getElementById('mainTitle').innerText = "å°å¸«è¾¦å…¬å®¤";
            else document.getElementById('mainTitle').innerText = (user.displayName || "æˆå“¡") + " çš„è¾¦å…¬å®¤";
        });

        document.getElementById('logoutBtn').onclick = () => signOut(auth);
    </script>
</body>
</html>

