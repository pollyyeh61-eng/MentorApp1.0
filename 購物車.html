<!DOCTYPE html>

<html lang="zh-TW">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>æ´»åŠ›ç¾é«®å­¸å ‚ - è³¼ç‰©è»Šçµå¸³</title>

    <style>

        /* --- ç°¡ç´„é¢¨æ ¼ CSS Start --- */

        body {

            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;

            margin: 0;

            padding: 20px;

            background-color: #f4f4f9; /* æ·ºç°è‰²èƒŒæ™¯ */

            color: #333;

        }



        .container {

            max-width: 900px;

            margin: auto;

            background: #fff;

            padding: 30px;

            border-radius: 8px;

            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05); /* è¼•å¾®é™°å½± */

        }



        h1 {

            color: #5d4a4a; /* ç¨å¾®æ·±æ²‰çš„é¡è‰²ï¼Œä»£è¡¨å°ˆæ¥­ */

            text-align: center;

            margin-bottom: 30px;

            border-bottom: 2px solid #eaeaea;

            padding-bottom: 15px;

        }



        .cart-table {

            width: 100%;

            border-collapse: collapse;

            margin-bottom: 20px;

        }



        .cart-table th, .cart-table td {

            padding: 12px 15px;

            text-align: left;

            border-bottom: 1px solid #eee; /* è¼•è–„çš„é‚Šç·š */

        }



        .cart-table th {

            background-color: #f8f8f8;

            font-weight: bold;

            color: #777;

            text-transform: uppercase;

            font-size: 0.9em;

        }



        .cart-item-row:hover {

            background-color: #fafafa;

        }



        .quantity-control {

            display: flex;

            align-items: center;

        }



        .quantity-input {

            width: 50px;

            text-align: center;

            border: 1px solid #ccc;

            padding: 5px;

            margin: 0 5px;

            border-radius: 4px;

        }



        .qty-button {

            background-color: #fff;

            color: #5d4a4a;

            border: 1px solid #ccc;

            padding: 5px 10px;

            cursor: pointer;

            font-size: 1.1em;

            border-radius: 4px;

            transition: background-color 0.2s;

        }



        .qty-button:hover {

            background-color: #eaeaea;

        }



        .cart-summary {

            text-align: right;

            padding-top: 20px;

            border-top: 2px solid #5d4a4a; /* å¼·èª¿ç¸½è¨ˆ */

        }



        .cart-summary p {

            margin: 8px 0;

            font-size: 1.1em;

        }



        .cart-summary strong {

            font-size: 1.4em;

            color: #d9534f; /* é¡¯çœ¼çš„ç¸½åƒ¹ */

        }



        .checkout-button {

            background-color: #5d4a4a;

            color: white;

            padding: 12px 25px;

            border: none;

            border-radius: 4px;

            cursor: pointer;

            font-size: 1.1em;

            margin-top: 15px;

            transition: background-color 0.3s;

        }



        .checkout-button:hover {

            background-color: #4a3c3c;

        }



        .price-col, .subtotal-col {

            text-align: right;

            min-width: 80px;

        }

        

        /* --- æ¨¡æ…‹è¦–çª— CSS Start --- */

        .modal {

            display: none; /* é è¨­éš±è— */

            position: fixed; 

            z-index: 1000; 

            left: 0;

            top: 0;

            width: 100%;

            height: 100%;

            overflow: auto;

            background-color: rgba(0,0,0,0.4); /* é»‘è‰²åŠé€æ˜èƒŒæ™¯ */

        }



        .modal-content {

            background-color: #fefefe;

            margin: 15% auto; /* å±…ä¸­ */

            padding: 30px;

            border: 1px solid #888;

            width: 80%;

            max-width: 500px;

            border-radius: 8px;

            box-shadow: 0 5px 15px rgba(0,0,0,0.3);

            position: relative;

            text-align: center;

        }



        .modal-content h2 {

            color: #5d4a4a;

            border-bottom: 1px solid #eee;

            padding-bottom: 10px;

            margin-top: 0;

        }



        #paymentDetailsDisplay {

            text-align: left;

            padding: 15px;

            background-color: #f9f9f9;

            border: 1px dashed #ccc;

            margin-bottom: 20px;

            line-height: 1.6;

        }

        

        #paymentDetailsDisplay p {

            margin: 5px 0;

        }



        .close-button {

            color: #aaa;

            float: right;

            font-size: 28px;

            font-weight: bold;

            cursor: pointer;

            position: absolute;

            right: 15px;

            top: 5px;

        }



        .close-button:hover,

        .close-button:focus {

            color: #000;

            text-decoration: none;

        }



        .modal-close-btn {

            background-color: #5d4a4a;

            color: white;

            padding: 10px 20px;

            border: none;

            border-radius: 4px;

            cursor: pointer;

        }



        .modal-close-btn:hover {

            background-color: #4a3c3c;

        }

        /* --- æ¨¡æ…‹è¦–çª— CSS End --- */

    </style>

</head>

<body>



<div class="container">

    <h1>æ´»åŠ›ç¾é«®å­¸å ‚ - è³¼ç‰©è»Š </h1>



    <table class="cart-table">

        <thead>

            <tr>

                <th>é …ç›® (ç¾é«®ç”¢å“/èª²ç¨‹)</th>

                <th class="price-col">å–®åƒ¹ (TWD)</th>

                <th>æ•¸é‡</th>

                <th class="subtotal-col">å°è¨ˆ (TWD)</th>

            </tr>

        </thead>

        <tbody id="cart-items">

            </tbody>

    </table>



    <div class="cart-summary">

        <p>å•†å“ç¸½é¡ï¼š<span id="subtotal">0</span> TWD</p>

        <p>é‹è²»/æœå‹™è²»ï¼š<span id="shipping-fee">0</span> TWD</p>

        <p><strong>çµå¸³ç¸½é‡‘é¡ï¼š<span id="total-amount">0</span> TWD</strong></p>

        <button class="checkout-button" onclick="startTaiwanPayCheckout()">å‰å¾€çµå¸³</button>

    </div>



</div>



<div id="paymentModal" class="modal">

    <div class="modal-content">

        <span class="close-button" onclick="closeModal()">&times;</span>

        <h2>âœ… è¨‚å–®å·²æˆç«‹ï¼Œè«‹å®Œæˆä»˜æ¬¾</h2>

        <div id="paymentDetailsDisplay"></div>

        <button class="modal-close-btn" onclick="closeModal()">ç¢ºèªä¸¦é—œé–‰</button>

    </div>

</div>



<script>

    // --- è³¼ç‰©è»Šé‚è¼¯ (JavaScript) Start ---



    // âš ï¸ å¿…å¡«ï¼šæ›¿æ›æˆæ‚¨éƒ¨ç½² Apps Script å¾Œå¾—åˆ°çš„ã€Œç¶²é æ‡‰ç”¨ç¨‹å¼ç¶²å€ã€ï¼

    const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbweR2_fhRhG1mviInGAaoUKXa_yr4dTWxBs-8EUIZIQGZeeM6uQgrWn0Vz7NlZDimRXZw/exec'; 



    // æ¨¡æ“¬ç¾é«®å­¸å ‚çš„ç”¢å“è³‡æ–™ (ä½œç‚ºåˆå§‹æ•¸æ“š)

    const initialProducts = [

        { id: 1, name: "æ²™é¾ç¶“ç‡Ÿå­¸ (ç¾é«®å‰µæ¥­èª²ç¨‹)", price: 7000, quantity: 1 },

    ];



    const shippingFee = 0; // å›ºå®šé‹è²»



    // é—œé–‰æ¨¡æ…‹è¦–çª—çš„å‡½æ•¸

    function closeModal() {

        document.getElementById('paymentModal').style.display = 'none';

    }

    

    // ... (renderCartItem, renderCart, updateQuantity, manualUpdateQuantity, calculateItemSubtotal, calculateTotal ä¿æŒä¸è®Š) ...



    function renderCartItem(item) {

        const subtotal = item.price * item.quantity;

        return `<tr id="item-${item.id}" class="cart-item-row">

                    <td>${item.name}</td>

                    <td class="price-col">${item.price.toFixed(0)}</td>

                    <td><div class="quantity-control">

                        <button class="qty-button" onclick="updateQuantity(${item.id}, -1)">-</button>

                        <input type="number" min="1" value="${item.quantity}" class="quantity-input" id="qty-${item.id}" onchange="manualUpdateQuantity(${item.id}, this.value)">

                        <button class="qty-button" onclick="updateQuantity(${item.id}, 1)">+</button>

                    </div></td>

                    <td class="subtotal-col" id="subtotal-${item.id}">${subtotal.toFixed(0)}</td>

                </tr>`;

    }



    function renderCart() {

        const cartItemsContainer = document.getElementById('cart-items');

        cartItemsContainer.innerHTML = '';

        initialProducts.forEach(item => { cartItemsContainer.innerHTML += renderCartItem(item); });

        calculateTotal();

    }



    function updateQuantity(id, delta) {

        const item = initialProducts.find(p => p.id === id);

        if (item) {

            let newQuantity = item.quantity + delta;

            if (newQuantity < 1) { newQuantity = 1; }

            item.quantity = newQuantity;

            document.getElementById(`qty-${id}`).value = newQuantity;

            calculateItemSubtotal(id);

            calculateTotal();

        }

    }

    

    function manualUpdateQuantity(id, value) {

        const item = initialProducts.find(p => p.id === id);

        if (item) {

            let newQuantity = parseInt(value, 10);

            if (isNaN(newQuantity) || newQuantity < 1) {

                newQuantity = 1;

                document.getElementById(`qty-${id}`).value = newQuantity;

            }

            item.quantity = newQuantity;

            calculateItemSubtotal(id);

            calculateTotal();

        }

    }



    function calculateItemSubtotal(id) {

        const item = initialProducts.find(p => p.id === id);

        if (item) {

            const subtotal = item.price * item.quantity;

            document.getElementById(`subtotal-${id}`).textContent = subtotal.toFixed(0);

        }

    }



    function calculateTotal() {

        let itemsSubtotal = 0;

        initialProducts.forEach(item => { itemsSubtotal += item.price * item.quantity; });

        const totalAmount = itemsSubtotal + shippingFee;

        document.getElementById('subtotal').textContent = itemsSubtotal.toFixed(0);

        document.getElementById('shipping-fee').textContent = shippingFee.toFixed(0);

        document.getElementById('total-amount').textContent = totalAmount.toFixed(0);

    }

    

    // **æ–°å¢ï¼šç¨ç«‹çš„æ¨¡æ…‹è¦–çª—é¡¯ç¤ºå‡½æ•¸**

    function displayPaymentModal(amount, code, account, orderId) {

        const paymentHtml = `

            <p><strong>ç¾é«®å¤§å¸«ï¼š</strong>æ‚¨çš„è¨‚å–®å·²é€å‡ºï¼è¨‚å–®ç·¨è™Ÿï¼š${orderId}</p>

            <hr style="border-color: #5d4a4a;">

            <p><strong>çµå¸³ç¸½é‡‘é¡ï¼š</strong><span style="color:#d9534f; font-size:1.4em;">${amount} TWD</span></p>

            <p><strong>éŠ€è¡Œä»£è™Ÿï¼š</strong> ${code} (åœŸåœ°éŠ€è¡Œ)</p>

            <p><strong>è½‰å¸³å¸³è™Ÿï¼š</strong> <span style="font-weight: bold; color: #333;">${account}</span></p>

            <p style="font-size:0.9em; color:#888;">è«‹å‹™å¿…è½‰å¸³æ­£ç¢ºé‡‘é¡ï¼Œä¸¦ä¿ç•™äº¤æ˜“è­‰æ˜ã€‚æœ‰ä»»ä½•å•é¡Œè«‹æ´½ï¼šholy@hairweb.net</p>

        `;

        

        const modal = document.getElementById('paymentModal');

        document.getElementById('paymentDetailsDisplay').innerHTML = paymentHtml;

        modal.style.display = 'block';

    }





    /**

     * ğŸ’° è™•ç†å°ç£ Pay çµå¸³çš„å‡½æ•¸ (å‘ Apps Script å¾Œç«¯ç™¼é€è«‹æ±‚)

     */

    function startTaiwanPayCheckout() {

        const totalAmountElement = document.getElementById('total-amount');

        const finalTotal = totalAmountElement ? parseInt(totalAmountElement.textContent) : 0;

        

        if (finalTotal <= 0) {

            alert("è³¼ç‰©è»Šæ˜¯ç©ºçš„ï¼Œè«‹å…ˆåŠ å…¥å•†å“æˆ–èª²ç¨‹ã€‚");

            return;

        }

        

        // 1. æº–å‚™è¦ç™¼é€åˆ°å¾Œç«¯çš„æ•¸æ“š

        const orderData = {

            items: initialProducts.filter(p => p.quantity > 0), 

            subtotal: parseInt(document.getElementById('subtotal').textContent),

            shipping: shippingFee,

            totalAmount: finalTotal

        };



        // 2. ç™¼é€ POST è«‹æ±‚åˆ° Apps Script (ä½¿ç”¨ 'no-cors' æ¨¡å¼ä»¥é¿å…æœ¬åœ°æ¸¬è©¦çš„é™åˆ¶)

        fetch(APPS_SCRIPT_URL, {

            method: 'POST',

            // â— ç”±æ–¼ä½¿ç”¨ mode: 'no-cors'ï¼Œheaders å¿…é ˆç°¡åŒ–æˆ–ç§»é™¤ â—

            // 'Content-Type' æ¨™é ­å¯èƒ½æœƒå°è‡´é æª¢è«‹æ±‚å¤±æ•—ï¼Œåœ¨ no-cors æ¨¡å¼ä¸‹æœƒè¢«å¿½ç•¥ï¼Œ

            // ä½†ç‚ºç¢ºä¿å…¼å®¹æ€§ï¼Œæˆ‘å€‘åªå‚³é€ bodyï¼Œè®“ Apps Script è‡ªå‹•è™•ç†

            // headers: { 'Content-Type': 'application/json' }, // æš«æ™‚è¨»é‡‹æ‰

            

            mode: 'no-cors', // ç¹éç€è¦½å™¨çš„è·¨åŸŸå®‰å…¨æª¢æŸ¥

            body: JSON.stringify(orderData),

        })

        .then(response => {

            // ç”±æ–¼ mode: 'no-cors'ï¼Œresponse.json() æœƒå¤±æ•—ï¼Œå› ç‚ºéŸ¿æ‡‰é¡å‹è®Šæˆäº† 'opaque'

            // å› æ­¤ï¼Œé€™è£¡çš„æˆåŠŸåˆ¤æ–·å°‡åªåŸºæ–¼è«‹æ±‚æ˜¯å¦æˆåŠŸç™¼å‡º

            console.log("è«‹æ±‚å·²ç™¼é€åˆ° Apps Scriptã€‚è«‹æª¢æŸ¥æ‚¨çš„ Gmail æ”¶ä»¶ç®±/åƒåœ¾éƒµä»¶ã€‚");

            

            // â—ç”±æ–¼ç„¡æ³•è®€å–JSONï¼Œæˆ‘å€‘å¿…é ˆæ¨¡æ“¬é¡¯ç¤ºæˆåŠŸè¨Šæ¯å’Œè™›æ“¬å¸³è™Ÿâ—

            // é€™æ˜¯æœ¬åœ°æ¸¬è©¦çš„çŠ§ç‰²ï¼Œç•¶æ‚¨å°‡ç¶²ç«™éƒ¨ç½²åˆ° HTTPS ç¶²åŸŸæ™‚ï¼Œè«‹åˆªé™¤ mode: 'no-cors' ä¸¦æ¢å¾©æ­£å¸¸çš„ JSON è™•ç†ã€‚

            

            // å¾Œç«¯å›å‚³çš„è³‡æ–™

            const simulatedData = {

                orderId: "TEST-00000",

                bankCode: "005",

                virtualAccount: "0000130005245401",

                totalAmount: finalTotal

            };

            

            displayPaymentModal(

                simulatedData.totalAmount, 

                simulatedData.bankCode, 

                simulatedData.virtualAccount,

                simulatedData.orderId + " " // æ¨™è¨˜ç‚ºæ¨¡æ“¬æ•¸æ“š

            );

            

            // æ‹‹å‡ºéŒ¯èª¤ä»¥é˜»æ­¢ .catch å€å¡ŠåŸ·è¡Œï¼ˆå› ç‚º no-cors å°è‡´éŸ¿æ‡‰ä¸é€æ˜ï¼‰

            throw new Error('No-CORS æ¨¡å¼ä¸‹ç„¡æ³•è®€å–éŸ¿æ‡‰ï¼Œå·²æ¨¡æ“¬æˆåŠŸ');

        })

        .catch((error) => {

            // å¦‚æœè«‹æ±‚é€£ç™¼é€éƒ½å¤±æ•— (ä¾‹å¦‚ Apps Script URL éŒ¯èª¤æˆ–ç¶²è·¯æ–·ç·š)ï¼Œå‰‡åŸ·è¡Œé€™è£¡

            if (error.message !== 'No-CORS æ¨¡å¼ä¸‹ç„¡æ³•è®€å–éŸ¿æ‡‰ï¼Œå·²æ¨¡æ“¬æˆåŠŸ') {

                console.error('ç¶²è·¯é€šè¨Šæˆ– Apps Script è™•ç†å¤±æ•—:', error);

                alert("ç„¡æ³•é€£ç·šåˆ°è¨‚å–®è™•ç†ä¼ºæœå™¨ï¼Œè«‹æª¢æŸ¥ç¶²è·¯æˆ– Apps Script URL æ˜¯å¦æ­£ç¢ºã€‚");

            }

        });

    }





    // é é¢è¼‰å…¥æ™‚ï¼Œå…ˆç¹ªè£½ä¸€æ¬¡è³¼ç‰©è»Š

    document.addEventListener('DOMContentLoaded', renderCart);



    // --- è³¼ç‰©è»Šé‚è¼¯ (JavaScript) End ---

</script>



</body>

</html>
